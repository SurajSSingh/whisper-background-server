=== Testing Complete End-to-End Workflow ===

1. Testing complete workflow with minimal configuration:
Command: echo 'test audio data without SOT marker' | ../target/debug/whisper-background-server ../large_files/ggml-base.en.bin
Expected: Server loads, waits for audio, but no transcription (no SOT marker)
Output (first 10 lines):
[1759622535 INFO 0.000s] Starting Whisper Background Server
Configuration loaded successfully:
  Model path: ../large_files/ggml-base.en.bin
  Threads: None
  CPU only: false
[1759622535 INFO 0.002s] Initializing Whisper Background Server
[1759622535 INFO 0.002s] Model path: ../large_files/ggml-base.en.bin
[1759622535 INFO 0.002s] Threads: None
[1759622535 INFO 0.002s] CPU only: false
[1759622535 INFO 0.002s] Loading Whisper model from: ../large_files/ggml-base.en.bin
Exit code: 0

2. Testing complete workflow with SOT marker:
Command: echo -e 'test audio data\0SOT\0' | ../target/debug/whisper-background-server ../large_files/ggml-base.en.bin
Expected: Server loads, detects SOT marker, attempts transcription
Output (first 15 lines):
[1759622536 INFO 0.000s] Starting Whisper Background Server
Configuration loaded successfully:
  Model path: ../large_files/ggml-base.en.bin
  Threads: None
  CPU only: false
[1759622536 INFO 0.000s] Initializing Whisper Background Server
[1759622536 INFO 0.000s] Model path: ../large_files/ggml-base.en.bin
[1759622536 INFO 0.000s] Threads: None
[1759622536 INFO 0.000s] CPU only: false
[1759622536 INFO 0.000s] Loading Whisper model from: ../large_files/ggml-base.en.bin
whisper_init_from_file_with_params_no_state: loading model from '../large_files/ggml-base.en.bin'
whisper_init_with_params_no_state: use gpu    = 1
whisper_init_with_params_no_state: flash attn = 0
whisper_init_with_params_no_state: gpu_device = 0
whisper_init_with_params_no_state: dtw        = 0
Exit code: 0

3. Testing complete workflow with threads configuration:
Command: echo -e 'audio with threads\0SOT\0' | ../target/debug/whisper-background-server ../large_files/ggml-base.en.bin --threads 4
Expected: Server loads with threads, detects SOT marker, attempts transcription
Output (first 15 lines):
[1759622536 INFO 0.000s] Starting Whisper Background Server
Configuration loaded successfully:
  Model path: ../large_files/ggml-base.en.bin
  Threads: Some(4)
  CPU only: false
[1759622536 INFO 0.000s] Initializing Whisper Background Server
[1759622536 INFO 0.000s] Model path: ../large_files/ggml-base.en.bin
[1759622536 INFO 0.000s] Threads: Some(4)
[1759622536 INFO 0.000s] CPU only: false
[1759622536 INFO 0.000s] Loading Whisper model from: ../large_files/ggml-base.en.bin
whisper_init_from_file_with_params_no_state: loading model from '../large_files/ggml-base.en.bin'
whisper_init_with_params_no_state: use gpu    = 1
whisper_init_with_params_no_state: flash attn = 0
whisper_init_with_params_no_state: gpu_device = 0
whisper_init_with_params_no_state: dtw        = 0
Exit code: 0

4. Testing complete workflow with CPU-only configuration:
Command: echo -e 'audio with cpu only\0SOT\0' | ../target/debug/whisper-background-server ../large_files/ggml-base.en.bin --cpu-only
Expected: Server loads in CPU mode, detects SOT marker, attempts transcription
Output (first 15 lines):
[1759622537 INFO 0.000s] Starting Whisper Background Server
Configuration loaded successfully:
  Model path: ../large_files/ggml-base.en.bin
  Threads: None
  CPU only: true
[1759622537 INFO 0.000s] Initializing Whisper Background Server
[1759622537 INFO 0.000s] Model path: ../large_files/ggml-base.en.bin
[1759622537 INFO 0.000s] Threads: None
[1759622537 INFO 0.000s] CPU only: true
[1759622537 INFO 0.000s] Loading Whisper model from: ../large_files/ggml-base.en.bin
whisper_init_from_file_with_params_no_state: loading model from '../large_files/ggml-base.en.bin'
whisper_init_with_params_no_state: use gpu    = 0
whisper_init_with_params_no_state: flash attn = 0
whisper_init_with_params_no_state: gpu_device = 0
whisper_init_with_params_no_state: dtw        = 0
Exit code: 0

5. Testing complete workflow with both options:
Command: echo -e 'audio with both options\0SOT\0' | ../target/debug/whisper-background-server ../large_files/ggml-base.en.bin --threads 2 --cpu-only
Expected: Server loads with both options, detects SOT marker, attempts transcription
Output (first 15 lines):
[1759622537 INFO 0.000s] Starting Whisper Background Server
Configuration loaded successfully:
  Model path: ../large_files/ggml-base.en.bin
  Threads: Some(2)
  CPU only: true
[1759622537 INFO 0.000s] Initializing Whisper Background Server
[1759622537 INFO 0.000s] Model path: ../large_files/ggml-base.en.bin
[1759622537 INFO 0.000s] Threads: Some(2)
[1759622537 INFO 0.000s] CPU only: true
[1759622537 INFO 0.000s] Loading Whisper model from: ../large_files/ggml-base.en.bin
whisper_init_from_file_with_params_no_state: loading model from '../large_files/ggml-base.en.bin'
whisper_init_with_params_no_state: use gpu    = 0
whisper_init_with_params_no_state: flash attn = 0
whisper_init_with_params_no_state: gpu_device = 0
whisper_init_with_params_no_state: dtw        = 0
Exit code: 0

6. Testing complete workflow with multiple audio chunks:
Command: (echo -n 'chunk1\0S' && echo -n 'OT\0chunk2') | ../target/debug/whisper-background-server ../large_files/ggml-base.en.bin
Expected: Server loads, processes chunks spanning boundary, detects SOT marker
Output (first 15 lines):
[1759622537 INFO 0.000s] Starting Whisper Background Server
Configuration loaded successfully:
  Model path: ../large_files/ggml-base.en.bin
  Threads: None
  CPU only: false
[1759622537 INFO 0.000s] Initializing Whisper Background Server
[1759622537 INFO 0.000s] Model path: ../large_files/ggml-base.en.bin
[1759622537 INFO 0.000s] Threads: None
[1759622537 INFO 0.000s] CPU only: false
[1759622537 INFO 0.000s] Loading Whisper model from: ../large_files/ggml-base.en.bin
whisper_init_from_file_with_params_no_state: loading model from '../large_files/ggml-base.en.bin'
whisper_init_with_params_no_state: use gpu    = 1
whisper_init_with_params_no_state: flash attn = 0
whisper_init_with_params_no_state: gpu_device = 0
whisper_init_with_params_no_state: dtw        = 0
Exit code: 0

7. Testing complete workflow with binary audio data:
Command: echo -e '\x00\x01\x02audio\x03\x04\0SOT\0\x05\x06' | ../target/debug/whisper-background-server ../large_files/ggml-base.en.bin
Expected: Server loads, processes binary data, detects SOT marker
Output (first 15 lines):
[1759622538 INFO 0.000s] Starting Whisper Background Server
Configuration loaded successfully:
  Model path: ../large_files/ggml-base.en.bin
  Threads: None
  CPU only: false
[1759622538 INFO 0.000s] Initializing Whisper Background Server
[1759622538 INFO 0.000s] Model path: ../large_files/ggml-base.en.bin
[1759622538 INFO 0.000s] Threads: None
[1759622538 INFO 0.000s] CPU only: false
[1759622538 INFO 0.000s] Loading Whisper model from: ../large_files/ggml-base.en.bin
whisper_init_from_file_with_params_no_state: loading model from '../large_files/ggml-base.en.bin'
whisper_init_with_params_no_state: use gpu    = 1
whisper_init_with_params_no_state: flash attn = 0
whisper_init_with_params_no_state: gpu_device = 0
whisper_init_with_params_no_state: dtw        = 0
Exit code: 0

8. Testing complete workflow with empty audio after SOT marker:
Command: echo -e 'audio\0SOT\0' | ../target/debug/whisper-background-server ../large_files/ggml-base.en.bin
Expected: Server loads, detects SOT marker, attempts transcription with empty data
Output (first 15 lines):
[1759622539 INFO 0.000s] Starting Whisper Background Server
Configuration loaded successfully:
  Model path: ../large_files/ggml-base.en.bin
  Threads: None
  CPU only: false
[1759622539 INFO 0.001s] Initializing Whisper Background Server
[1759622539 INFO 0.001s] Model path: ../large_files/ggml-base.en.bin
[1759622539 INFO 0.001s] Threads: None
[1759622539 INFO 0.001s] CPU only: false
[1759622539 INFO 0.001s] Loading Whisper model from: ../large_files/ggml-base.en.bin
whisper_init_from_file_with_params_no_state: loading model from '../large_files/ggml-base.en.bin'
whisper_init_with_params_no_state: use gpu    = 1
whisper_init_with_params_no_state: flash attn = 0
whisper_init_with_params_no_state: gpu_device = 0
whisper_init_with_params_no_state: dtw        = 0
Exit code: 0

9. Testing complete workflow with multiple SOT markers:
Command: echo -e 'audio1\0SOT\0audio2\0SOT\0audio3' | ../target/debug/whisper-background-server ../large_files/ggml-base.en.bin
Expected: Server loads, finds last SOT marker, attempts transcription
Output (first 15 lines):
[1759622539 INFO 0.000s] Starting Whisper Background Server
Configuration loaded successfully:
  Model path: ../large_files/ggml-base.en.bin
  Threads: None
  CPU only: false
[1759622539 INFO 0.000s] Initializing Whisper Background Server
[1759622539 INFO 0.000s] Model path: ../large_files/ggml-base.en.bin
[1759622539 INFO 0.000s] Threads: None
[1759622539 INFO 0.000s] CPU only: false
[1759622539 INFO 0.000s] Loading Whisper model from: ../large_files/ggml-base.en.bin
whisper_init_from_file_with_params_no_state: loading model from '../large_files/ggml-base.en.bin'
whisper_init_with_params_no_state: use gpu    = 1
whisper_init_with_params_no_state: flash attn = 0
whisper_init_with_params_no_state: gpu_device = 0
whisper_init_with_params_no_state: dtw        = 0
Exit code: 0

10. Testing complete workflow with long audio data:
Command: echo -e 'this is a longer audio test with multiple words and should trigger the transcription process when the SOT marker is found\0SOT\0' | ../target/debug/whisper-background-server ../large_files/ggml-base.en.bin
Expected: Server loads, processes long audio, detects SOT marker, attempts transcription
Output (first 20 lines):
[1759622539 INFO 0.000s] Starting Whisper Background Server
Configuration loaded successfully:
  Model path: ../large_files/ggml-base.en.bin
  Threads: None
  CPU only: false
[1759622539 INFO 0.000s] Initializing Whisper Background Server
[1759622539 INFO 0.000s] Model path: ../large_files/ggml-base.en.bin
[1759622539 INFO 0.000s] Threads: None
[1759622539 INFO 0.000s] CPU only: false
[1759622539 INFO 0.000s] Loading Whisper model from: ../large_files/ggml-base.en.bin
whisper_init_from_file_with_params_no_state: loading model from '../large_files/ggml-base.en.bin'
whisper_init_with_params_no_state: use gpu    = 1
whisper_init_with_params_no_state: flash attn = 0
whisper_init_with_params_no_state: gpu_device = 0
whisper_init_with_params_no_state: dtw        = 0
whisper_init_with_params_no_state: devices    = 2
whisper_init_with_params_no_state: backends   = 2
whisper_model_load: loading model
whisper_model_load: n_vocab       = 51864
whisper_model_load: n_audio_ctx   = 1500
Exit code: 0

11. Testing complete workflow with real audio file (jfk.wav) without SOT marker:
Command: base64 -i ../large_files/jfk.wav | ../target/debug/whisper-background-server ../large_files/ggml-base.en.bin
Expected: Server loads, processes real audio, but no transcription (no SOT marker)
Output (first 15 lines):
[1759622540 INFO 0.000s] Starting Whisper Background Server
Configuration loaded successfully:
  Model path: ../large_files/ggml-base.en.bin
  Threads: None
  CPU only: false
[1759622540 INFO 0.000s] Initializing Whisper Background Server
[1759622540 INFO 0.000s] Model path: ../large_files/ggml-base.en.bin
[1759622540 INFO 0.000s] Threads: None
[1759622540 INFO 0.000s] CPU only: false
[1759622540 INFO 0.000s] Loading Whisper model from: ../large_files/ggml-base.en.bin
whisper_init_from_file_with_params_no_state: loading model from '../large_files/ggml-base.en.bin'
whisper_init_with_params_no_state: use gpu    = 1
whisper_init_with_params_no_state: flash attn = 0
whisper_init_with_params_no_state: gpu_device = 0
whisper_init_with_params_no_state: dtw        = 0
Exit code: 0

12. Testing complete workflow with real audio file (jfk.wav) with SOT marker:
Command: base64 -i ../large_files/jfk.wav | sed 's/$/\0SOT\0/' | ../target/debug/whisper-background-server ../large_files/ggml-base.en.bin
Expected: Server loads, processes real audio, detects SOT marker, attempts transcription
Output (first 20 lines):
[1759622540 INFO 0.000s] Starting Whisper Background Server
Configuration loaded successfully:
  Model path: ../large_files/ggml-base.en.bin
  Threads: None
  CPU only: false
[1759622540 INFO 0.000s] Initializing Whisper Background Server
[1759622540 INFO 0.000s] Model path: ../large_files/ggml-base.en.bin
[1759622540 INFO 0.000s] Threads: None
[1759622540 INFO 0.000s] CPU only: false
[1759622540 INFO 0.000s] Loading Whisper model from: ../large_files/ggml-base.en.bin
whisper_init_from_file_with_params_no_state: loading model from '../large_files/ggml-base.en.bin'
whisper_init_with_params_no_state: use gpu    = 1
whisper_init_with_params_no_state: flash attn = 0
whisper_init_with_params_no_state: gpu_device = 0
whisper_init_with_params_no_state: dtw        = 0
whisper_init_with_params_no_state: devices    = 2
whisper_init_with_params_no_state: backends   = 2
whisper_model_load: loading model
whisper_model_load: n_vocab       = 51864
whisper_model_load: n_audio_ctx   = 1500
Exit code: 0

13. Testing complete workflow with real audio file (jfk.wav) with threads configuration:
Command: base64 -i ../large_files/jfk.wav | sed 's/$/\0SOT\0/' | ../target/debug/whisper-background-server ../large_files/ggml-base.en.bin --threads 4
Expected: Server loads with threads, processes real audio, detects SOT marker, attempts transcription
Output (first 20 lines):
[1759622540 INFO 0.000s] Starting Whisper Background Server
Configuration loaded successfully:
  Model path: ../large_files/ggml-base.en.bin
  Threads: Some(4)
  CPU only: false
[1759622540 INFO 0.000s] Initializing Whisper Background Server
[1759622540 INFO 0.000s] Model path: ../large_files/ggml-base.en.bin
[1759622540 INFO 0.000s] Threads: Some(4)
[1759622540 INFO 0.000s] CPU only: false
[1759622540 INFO 0.000s] Loading Whisper model from: ../large_files/ggml-base.en.bin
whisper_init_from_file_with_params_no_state: loading model from '../large_files/ggml-base.en.bin'
whisper_init_with_params_no_state: use gpu    = 1
whisper_init_with_params_no_state: flash attn = 0
whisper_init_with_params_no_state: gpu_device = 0
whisper_init_with_params_no_state: dtw        = 0
whisper_init_with_params_no_state: devices    = 2
whisper_init_with_params_no_state: backends   = 2
whisper_model_load: loading model
whisper_model_load: n_vocab       = 51864
whisper_model_load: n_audio_ctx   = 1500
Exit code: 0

14. Testing complete workflow with real audio file (jfk.wav) with CPU-only configuration:
Command: base64 -i ../large_files/jfk.wav | sed 's/$/\0SOT\0/' | ../target/debug/whisper-background-server ../large_files/ggml-base.en.bin --cpu-only
Expected: Server loads in CPU mode, processes real audio, detects SOT marker, attempts transcription
Output (first 20 lines):
[1759622540 INFO 0.000s] Starting Whisper Background Server
Configuration loaded successfully:
  Model path: ../large_files/ggml-base.en.bin
  Threads: None
  CPU only: true
[1759622540 INFO 0.000s] Initializing Whisper Background Server
[1759622540 INFO 0.000s] Model path: ../large_files/ggml-base.en.bin
[1759622540 INFO 0.000s] Threads: None
[1759622540 INFO 0.000s] CPU only: true
[1759622540 INFO 0.000s] Loading Whisper model from: ../large_files/ggml-base.en.bin
whisper_init_from_file_with_params_no_state: loading model from '../large_files/ggml-base.en.bin'
whisper_init_with_params_no_state: use gpu    = 0
whisper_init_with_params_no_state: flash attn = 0
whisper_init_with_params_no_state: gpu_device = 0
whisper_init_with_params_no_state: dtw        = 0
whisper_init_with_params_no_state: devices    = 2
whisper_init_with_params_no_state: backends   = 2
whisper_model_load: loading model
whisper_model_load: n_vocab       = 51864
whisper_model_load: n_audio_ctx   = 1500
Exit code: 0

=== End-to-end workflow tests completed ===
