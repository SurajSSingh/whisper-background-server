=== Testing Argument Parsing (Simple) ===

1. Testing minimal arguments (model path only):
Command: echo 'test audio data' | ../target/debug/whisper-background-server ../large_files/ggml-base.en.bin &
Output:
Exit code: 1

2. Testing with threads option:
Command: echo 'test audio data' | ../target/debug/whisper-background-server ../large_files/ggml-base.en.bin --threads 4 &
Output:
Exit code: 1

3. Testing with CPU-only flag:
Command: echo 'test audio data' | ../target/debug/whisper-background-server ../large_files/ggml-base.en.bin --cpu-only &
Output:
Exit code: 1

4. Testing error case - no arguments:
Command: ../target/debug/whisper-background-server
Output:
[1759621793 INFO 0.000s] Starting Whisper Background Server
Error: Model path is required. Usage: whisper-background-server <model-path> [--threads <number>] [--cpu-only]
Usage: whisper-background-server <model-path> [--threads <number>] [--cpu-only]
Exit code: 0

5. Testing error case - invalid model path:
Command: ../target/debug/whisper-background-server /nonexistent/path/model.bin
Output:
[1759621793 INFO 0.000s] Starting Whisper Background Server
Error: Model path does not exist: /nonexistent/path/model.bin
Usage: whisper-background-server <model-path> [--threads <number>] [--cpu-only]
Exit code: 0

6. Testing error case - invalid threads value:
Command: ../target/debug/whisper-background-server ../large_files/ggml-base.en.bin --threads invalid
Output:
[1759621793 INFO 0.000s] Starting Whisper Background Server
Error: Invalid number of threads: invalid
Usage: whisper-background-server <model-path> [--threads <number>] [--cpu-only]
Exit code: 0

7. Testing error case - unknown argument:
Command: ../target/debug/whisper-background-server ../large_files/ggml-base.en.bin --unknown
Output:
[1759621793 INFO 0.000s] Starting Whisper Background Server
Error: Unknown argument: --unknown
Usage: whisper-background-server <model-path> [--threads <number>] [--cpu-only]
Exit code: 0

8. Testing with real audio file (jfk.wav):
Command: base64 -i ../large_files/jfk.wav | ../target/debug/whisper-background-server ../large_files/ggml-base.en.bin
Output (first 10 lines):
[1759621793 INFO 0.000s] Starting Whisper Background Server
Configuration loaded successfully:
  Model path: ../large_files/ggml-base.en.bin
  Threads: None
  CPU only: false
[1759621793 INFO 0.000s] Initializing Whisper Background Server
[1759621793 INFO 0.000s] Model path: ../large_files/ggml-base.en.bin
[1759621793 INFO 0.000s] Threads: None
[1759621793 INFO 0.000s] CPU only: false
[1759621793 INFO 0.000s] Loading Whisper model from: ../large_files/ggml-base.en.bin
Exit code: 0

9. Testing real audio file with SOT marker:
Command: base64 -i ../large_files/jfk.wav | sed 's/$/\0SOT\0/' | ../target/debug/whisper-background-server ../large_files/ggml-base.en.bin
Output (first 15 lines):
[1759621793 INFO 0.000s] Starting Whisper Background Server
Configuration loaded successfully:
  Model path: ../large_files/ggml-base.en.bin
  Threads: None
  CPU only: false
[1759621793 INFO 0.000s] Initializing Whisper Background Server
[1759621793 INFO 0.000s] Model path: ../large_files/ggml-base.en.bin
[1759621793 INFO 0.000s] Threads: None
[1759621793 INFO 0.000s] CPU only: false
[1759621793 INFO 0.000s] Loading Whisper model from: ../large_files/ggml-base.en.bin
whisper_init_from_file_with_params_no_state: loading model from '../large_files/ggml-base.en.bin'
whisper_init_with_params_no_state: use gpu    = 1
whisper_init_with_params_no_state: flash attn = 0
whisper_init_with_params_no_state: gpu_device = 0
whisper_init_with_params_no_state: dtw        = 0
Exit code: 0

10. Testing real audio file with threads configuration:
Command: base64 -i ../large_files/jfk.wav | sed 's/$/\0SOT\0/' | ../target/debug/whisper-background-server ../large_files/ggml-base.en.bin --threads 4
Output (first 15 lines):
[1759621793 INFO 0.000s] Starting Whisper Background Server
Configuration loaded successfully:
  Model path: ../large_files/ggml-base.en.bin
  Threads: Some(4)
  CPU only: false
[1759621793 INFO 0.000s] Initializing Whisper Background Server
[1759621793 INFO 0.000s] Model path: ../large_files/ggml-base.en.bin
[1759621793 INFO 0.000s] Threads: Some(4)
[1759621793 INFO 0.000s] CPU only: false
[1759621793 INFO 0.000s] Loading Whisper model from: ../large_files/ggml-base.en.bin
whisper_init_from_file_with_params_no_state: loading model from '../large_files/ggml-base.en.bin'
whisper_init_with_params_no_state: use gpu    = 1
whisper_init_with_params_no_state: flash attn = 0
whisper_init_with_params_no_state: gpu_device = 0
whisper_init_with_params_no_state: dtw        = 0
Exit code: 0

=== Argument parsing tests completed ===
